<html>
{% extends "index.html" %} {% load crispy_forms_tags %} {% block page_content %}

<head>
    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/engagement_index.css' %}" />
</head>

<body>
    <div class="container">
        <!-- add project button -->
        <div class="" style="text-align:right; margin-top:1%">
            <button type="button" class="icon-btn add-btn" data-toggle="modal" data-target="#addProject">
                <div class="add-icon"></div>
                <div class="btn-txt">Add Project</div>
            </button>
        </div>
        <!-- end of add project button -->


        <!-- add project form -->
        <div class="container">
            <!-- The Modal -->
            <div class="modal fade" id="addProject" style="height: 90%; margin-top: 30px;">
                <div class="modal-dialog modal-dialog-scrollable modal-lg">
                    <div class="modal-content">

                        <!-- Modal Header -->
                        <div class="modal-header">
                            <h4 class="modal-title">New Project</h4>
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                        </div>

                        <!-- Modal body -->
                        <div class="modal-body">
                            <form class="cuba" action="" method="post">
                                {% csrf_token %} {% for field in form %}
                                <div class="group">
                                    <!-- <input type="text" required="true" id="{{form.title.id_for_label}}"> -->
                                    {{field}}
                                    <span class="highlight"></span>
                                    <span class="bar"></span>
                                    <label>{{field.label}}</label>
                                </div>
                                {% endfor %}
                        </div>
                        <!-- {% comment %}
                    <div class="group">
                         <input type="text" required="true" id="{{ form.body.id_for_label }}">
                        {{form.body}}
                        <span class="highlight"></span>
                        <span class="bar"></span>
                        <label>{{ form.body.label }}</label>
                    </div>

                    <div class="row">
                        <div class="col">
                            <div class="group">
                                <input type="text" required="true" id="{{ form.startDate.id_for_label }}">
                                {{ form.startDate }}
                                <span class="highlight"></span>
                                <span class="bar"></span>
                                <label>{{ form.startDate.label }}</label>
                            </div>
                        </div>
                        &nbsp; &nbsp;
                        <div class="col">
                            <div class="group">
                                <input type="text" required="true" id="{{ form.endDate.id_for_label }}">
                                {{ form.endDate }}
                                <span class="highlight"></span>
                                <span class="bar"></span>
                                <label>{{ form.endDate.label }}</label>
                            </div>
                        </div>
                    </div>

                    <div class="group">
                        <input type="text" required="true" id="{{ form.staffId.id_for_label }}">
                        {{ form.staffId }}
                        <span class="highlight"></span>
                        <span class="bar"></span>
                        <label>{{ form.staffId.label }}</label>
                    </div> {% endcomment %} -->
                        <div class="modal-footer">
                            <input type="submit" name="addProj" class="btn" value="Submit" style="background-color: #D80032; color: white; width: auto;">
                        </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <!-- end of add project form -->


        <!-- <h1>Engagements</h1> -->
        <div class="row">
            {% for engagement in engagements %}

            <div class="col-md-3 py-4">
                {% comment %} <div class="hellO" style="display:none">
                    {{ engagement.id }}
                </div> {% endcomment %}
                <div class="card mb-1">
                    <div class="progress a">
                        <div class="progress-bar bg-success" role="progressbar" style="width:{{ engagement.progress }}" aria-valuenow="{{engagement.progress}}" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <div class="card-content">
                        <p>
                            <strong>{{ engagement.title }}</strong><br /> {{ engagement.body }}
                        </p>
                        
                        <hr />
                        <p id="dueDate" style="left:0px;"><i class="fas far fa-calendar-alt" style="width: 200px; color: #F8D112;">&nbsp;&nbsp;{{ engagement.endDate }}</i></p>
                        <div class="icon-block">
                            <a href="#teamList" data-toggle="modal"><i class="hovhighlight fas fa-users"></i></a>
                            <a class="buttonEditProj" onclick="loadEngagementId({{ engagement.id }})" style="color: #D80032; text-decoration: none;" button_proj_id={{engagement.id}}><i class="hovhighlight fas fa-pen"></i></a>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <!-- end of the Engagement for loop -->


        <!-- modal to display the team members engaged in the project -->
        <div class="container">
            <!-- The Modal -->
            <div class="modal" id="teamList" style="margin-top: 100px; height: 70%;">
                <div class="modal-dialog modal-lg modal-dialog-scrollable">
                    <div class="modal-content">

                        <!-- Modal Header -->
                        <div class="modal-header">
                            <h1 class="modal-title" style="color: #086788;">Project Team Members</h1>
                            <button type="button" class="close" data-dismiss="modal" style="color: #D80032; padding-right: 20px;">Ã—</button>
                        </div>

                        <!-- Modal body -->
                        <div class="modal-body">
                            <ul class="list-group">
                                {% for engagement in engagements %}
                                <li class="list-group-item">{{ engagement.title }}</li>
                                {% for staff in engagement.staff.all.values %}
                                <li class="list-group-item">{{ staff.name }}&nbsp;({{ staff.staffId }})</li>
                                {% endfor %} {% endfor %}
                            </ul>
                        </div>

                        <!-- Modal footer -->
                        <div class="modal-footer">
                            <button type="button" class="btn" style="background-color: #D80032; color: white;" data-dismiss="modal"><strong>Close</strong></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- end of modal -->


        <!-- edit project card -->
        <div class="modal" id="editProject">
            <div class="modal-dialog modal-dialog-centered" style="justify-content: center;">
                <div class="modal-content">

                    <!-- Modal body -->
                    <div class="card mb-1" style="height: 600px;">

                        <div class="card-content">
                            <form class="editProjectCard">
                                <label for="pname" class="inline-block"></label>
                                <strong><input type="text" id="pname" name="pname" value="project[1]" class="inline-block"></strong>
                                <label for="pdesc"></label>
                                <input type="text" id="pdesc" name="pdesc" value="edit this edit that" style="margin-top: 0px;">
                            </form>

                            <hr />

                            <form action="" class="editProjectCard_sec">
                                <div class="input-group mb-3" style="border: 0; border-radius: 0px; outline: none; -webkit-appearance: none;">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">
                                            <i class="fas far fa-calendar-alt" style="color: #F8D112;"></i>
                                        </span>
                                    </div>
                                    <input type="text" class="form-control" placeholder="March 03, 2021" id="editDue" name="editDue">
                                </div>

                                <div class="input-group mb-3" style="border: 0; border-radius: 0px; outline: none; -webkit-appearance: none;">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">
                                            <i class="fas fa-ellipsis-h" style="color: #47a025;"></i>
                                        </span>
                                    </div>
                                    <input type="text" class="form-control" placeholder="Progress: 40%" id="editDue" name="editDue">
                                </div>

                                <div class="input-group mb-3" style="border: 0; border-radius: 0px; outline: none; -webkit-appearance: none;">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">
                                            <i class="hovhighlight fas fa-users" style="color: #FF7A0D;"></i>
                                        </span>
                                    </div>
                                    <input type="text" class="form-control" placeholder="Fie, Luis, Cornor, Cameo" id="editDue" name="editDue">
                                </div>

                                <button type="submit" class="btn btn-primary" style="position: absolute; bottom: 20px; right: 20px; background-color: #D80032; outline: none; border: none;">UPDATE</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- end of edit project card -->

    </div>
    <script>
        function loadEngagementId(id_in) {
            var engagementId_editButton = id_in;
            console.log(engagementId_editButton)
            $.ajax({
                url: "{% url 'getengagementid' %}", 
                type : "POST",
                data : {
                    "pk_in" : engagementId_editButton,
                },
                dataType : "json",

                success: function(results){
                    if (results.success == "True") {
                        console.log(results)
                        console.log(results.project[3])
                        // here should fire up modal and send data to modal
                        temp = $("#editProject").data(results.project);
                        console.log(temp)
                        $("#editProject").modal('show');
                    }
                    else { 
                        showErrorMessage() ;
                    } 
                },

                headers:{
                    "X-CSRFToken": $("[name=csrfmiddlewaretoken]").val()
                },
            });
        };

    </script>


</body>



{% load static %}
<script type="text/javascript" src="{% static 'js\engagement_index.js' %}"></script>


{% endblock %}

</html>